<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>
  <!--IMPORTAMOS FUENTES-->
  <link
    href="https://fonts.googleapis.com/css?family=ABeeZee&display=swap"
    rel="stylesheet"
  />

  <style>
    canvas {
      background-color: whitesmoke;
      border: 1px solid black;
      width: 100%;
      /*transform: rotate(180deg);*/
    }

    .botones {
      display: flex;
      justify-content: space-between;
    }

    button {
      border-radius: 15px;
      font-family: "ABeeZee", sans-serif;
      font-size: xx-large;
      width: 400px;
      height: 50px;
      border: 4px solid black;
      background-color: darkseagreen;
    }
  </style>
  <body>
    <canvas height="900" width="1300" id="canvas"></canvas>
    <div class="botones">
      <button id="hombre">Home</button>
      <button id="mujer">Muyer</button>
      <button id="ambos">Dambos</button>
    </div>

    <script>
      //BOTONES
      document
        .getElementById("hombre")
        .addEventListener("click", mostrarHombres);

      document
        .getElementById("mujer")
        .addEventListener("click", mostrarMujeres);

      document.getElementById("ambos").addEventListener("click", mostrarAmbos);

      function pintarEjes() {
        //pintamos las marcas

        //pinto línea eje Y
        ctx.beginPath();
        ctx.moveTo(80, 160);
        ctx.lineTo(80, 890);
        ctx.stroke();
        ctx.closePath();

        ctx.beginPath();
        x = 0;
        for (let i = 0; i < 890; i = i + 1000 / 34) {
          ctx.beginPath();
          ctx.moveTo(80, 160 + i);
          ctx.lineTo(1180, 160 + i);
          ctx.lineWidth = 0.2;
          ctx.stroke();
          ctx.closePath();

          ctx.fillStyle = "black";
          ctx.font = "13px Abeezee";
          ctx.fillText(1000 * x, 40, 160 + i);

          ++x;
        }
        ctx.closePath();

        //pinto línea eje X
        ctx.beginPath();
        ctx.moveTo(80, 160);
        ctx.lineTo(1180, 160);
        ctx.lineWidth = 0.2;
        ctx.stroke();
        ctx.closePath();
      }

      function mostrarHombres() {
        //reinicio el canvas
        separacion = 90;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        //pintamos ejes de nuevo
        pintarEjes();

        //peticion ajax
        var xhr = new XMLHttpRequest();
        xhr.open(
          "GET",
          "http://opendata.gijon.es/descargar.php?id=217&tipo=JSON",
          true
        );

        xhr.onload = function() {
          if (this.status == 200) {
            const json = JSON.parse(this.responseText);

            //pintamos puntos
            json.poblaciones.poblacion.forEach(punto => pintarHombre(punto));
          }
        };
        xhr.send();
      }

      function mostrarMujeres() {
        //reinicio el canvas
        separacion = 90;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        //pintamos ejes de nuevo
        pintarEjes();

        var xhr = new XMLHttpRequest();
        xhr.open(
          "GET",
          "http://opendata.gijon.es/descargar.php?id=217&tipo=JSON",
          true
        );

        xhr.onload = function() {
          if (this.status == 200) {
            const json = JSON.parse(this.responseText);

            //pintamos puntos
            json.poblaciones.poblacion.forEach(punto => pintarMujer(punto));
          }
        };
        xhr.send();
      }

      function mostrarAmbos() {
        //reinicio el canvas
        separacion = 90;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        //pintamos lineas de nuevo
        pintarEjes();

        var xhr = new XMLHttpRequest();
        xhr.open(
          "GET",
          "http://opendata.gijon.es/descargar.php?id=217&tipo=JSON",
          true
        );

        xhr.onload = function() {
          if (this.status == 200) {
            const json = JSON.parse(this.responseText);

            //pintamos puntos
            json.poblaciones.poblacion.forEach(punto => pintarAmbos(punto));
          }
        };
        xhr.send();
      }

      //inicializamos
      var puntoAnterior = { varon: 0 };
      var separacion = 90;
      var canvas = document.getElementById("canvas");
      var ctx = canvas.getContext("2d");

      function pintarHombre(punto) {
        //hombres
        ctx.beginPath();
        ctx.arc(separacion, 180 + punto.varon / 35, 5, 0, 2 * Math.PI);
        ctx.fillStyle = "blue";
        ctx.fill();
        ctx.closePath();

        //nombres
        ctx.beginPath();
        ctx.save();

        ctx.translate(separacion, 150);
        ctx.rotate(-Math.PI / 2);

        ctx.textAlign = "left";
        ctx.fillStyle = "black";
        ctx.font = "13px abeezee";
        ctx.fillText(punto.barrio, 0, 15 / 2);

        ctx.restore();
        ctx.closePath();

        ctx.puntoAnterior = punto;
        separacion += 24;
      }

      function pintarMujer(punto) {
        //mujeres
        ctx.beginPath();
        ctx.arc(separacion, 180 + punto.mujer / 35, 5, 0, 2 * Math.PI);
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.closePath();

        //nombres
        ctx.beginPath();
        ctx.save();

        ctx.translate(separacion, 150);
        ctx.rotate(-Math.PI / 2);

        ctx.textAlign = "left";
        ctx.fillStyle = "black";
        ctx.font = "13px abeezee";
        ctx.fillText(punto.barrio, 0, 15 / 2);

        ctx.restore();
        ctx.closePath();

        ctx.puntoAnterior = punto;
        separacion += 24;
      }

      function pintarAmbos(punto) {
        //hombres
        ctx.beginPath();
        ctx.arc(separacion, 180 + punto.varon / 35, 5, 0, 2 * Math.PI);
        ctx.fillStyle = "blue";
        ctx.fill();
        ctx.closePath();

        //mujeres
        ctx.beginPath();
        ctx.arc(separacion, 180 + punto.mujer / 35, 5, 0, 2 * Math.PI);
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.closePath();

        //nombres
        ctx.beginPath();
        ctx.save();

        ctx.translate(separacion, 150);
        ctx.rotate(-Math.PI / 2);

        ctx.textAlign = "left";
        ctx.fillStyle = "black";
        ctx.font = "13px abeezee";
        ctx.fillText(punto.barrio, 0, 15 / 2);

        ctx.restore();
        ctx.closePath();

        ctx.puntoAnterior = punto;
        separacion += 24;
      }
    </script>
  </body>
</html>
